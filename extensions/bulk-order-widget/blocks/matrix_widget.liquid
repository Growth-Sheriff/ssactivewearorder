<div class="ss-clean-widget"
     id="ss-matrix-widget-{{ block.id }}"
     data-variants='{{ product.variants | json | escape }}'
     data-product-id="{{ product.id }}"
     data-show-warehouse="{{ block.settings.show_warehouse }}"
     data-button-text="{{ block.settings.button_text }}"
     data-customer-logged-in="{% if customer %}true{% else %}false{% endif %}"
     data-customer-name="{{ customer.first_name | escape }}"
     data-vip-discount="{{ block.settings.vip_discount | default: 10 }}"
     data-vip-min-order="{{ block.settings.vip_min_order | default: 200 }}"
     data-vip-enabled="{{ block.settings.vip_enabled | default: false }}">

  <!-- 1. HEADER: Only if title is set -->
  {% if block.settings.widget_title != blank %}
  <div class="ss-header">
    <h3 class="ss-title">{{ block.settings.widget_title }}</h3>
  </div>
  {% endif %}
  <div class="ss-loading" style="display:none;">
    <span class="ss-spinner"></span>
  </div>

  <!-- VIP MEMBER ALERT (Only for logged-in customers) -->
  {% if customer and block.settings.vip_enabled %}
  <div class="ss-vip-alert" id="ss-vip-alert-{{ block.id }}">
    <div class="ss-vip-badge">üëë VIP</div>
    <div class="ss-vip-body">
      <div class="ss-vip-title" id="ss-vip-title-{{ block.id }}">
        Welcome back, {{ customer.first_name }}! You qualify for member-exclusive pricing.
      </div>
      <div class="ss-vip-detail" id="ss-vip-detail-{{ block.id }}">
        üî• Extra <strong>{{ block.settings.vip_discount | default: 10 }}% OFF</strong> on orders over
        <strong>${{ block.settings.vip_min_order | default: 200 }}</strong> ‚Äî on top of volume discounts!
      </div>
      <div class="ss-vip-status" id="ss-vip-status-{{ block.id }}"></div>
    </div>
  </div>
  {% elsif customer == nil and block.settings.vip_enabled %}
  <div class="ss-vip-guest-hint" id="ss-vip-guest-{{ block.id }}">
    üîê <a href="/account/login" class="ss-vip-login-link">Sign in</a> to unlock <strong>exclusive member discounts</strong> on bulk orders!
  </div>
  {% endif %}

  <!-- 2. COLOR SELECTION: Modern Floating Circles -->
  <!-- Logic: Get unique colors safely using 'map' and 'uniq' filters -->
  {% assign unique_colors = product.variants | map: 'option1' | uniq %}

  <div class="ss-section">
    <div class="ss-label">Select Color <span id="ss-selected-color-name"></span></div>
    <div class="ss-color-list">
      {% for color_name in unique_colors %}
        <!-- Find the first variant with this color to get the image -->
        {% assign variant_image = "" %}
        {% for v in product.variants %}
          {% if v.option1 == color_name %}
            {% if v.image %}
              {% assign variant_image = v.image %}
            {% endif %}
            {% break %}
          {% endif %}
        {% endfor %}

        <div class="ss-color-item"
             data-color="{{ color_name | escape }}"
             onclick="window.selectMatrixColor('{{ color_name | escape }}', '{{ block.id }}')">

          <div class="ss-color-circle">
            {% if variant_image %}
              <img src="{{ variant_image | img_url: '100x100', crop: 'center' }}"
                   alt="{{ color_name }}" width="100" height="100" loading="lazy">
            {% else %}
              <span class="ss-no-img"></span>
            {% endif %}
          </div>
          <span class="ss-tooltip">{{ color_name }}</span>
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- 2b. VOLUME PRICING (Dynamic JS) -->
  <div class="ss-section ss-volume-wrapper" id="ss-volume-{{ block.id }}" style="display:none;">
    <div class="ss-label">Quantity Discounts</div>
    <div class="ss-volume-scroll">
      <div class="ss-volume-row" id="ss-volume-content-{{ block.id }}">
         <!-- Populated by JS -->
      </div>
    </div>
  </div>

  <!-- 3. SIZE & QUANTITY MATRIX (Static Render) -->
  <div class="ss-section ss-matrix-container">
    <div class="ss-label" style="font-size:14px; font-weight:700; margin-bottom:15px; color:#111;">SELECT QUANTITIES</div>

    {% for color_name in unique_colors %}
      <!-- Create a container for EACH color -->
      <div class="ss-size-group"
           data-color-group="{{ color_name | escape }}"
           style="{% unless forloop.first %}display:none;{% endunless %}">

        <div class="ss-grid-layout">
          {% for v in product.variants %}
            {% if v.option1 == color_name %}
              <div class="ss-size-item">
                <div class="ss-size-header">
                  <span class="ss-size-name">{{ v.option2 | default: 'One Size' }}</span>
                  {% if v.inventory_quantity > 0 %}
                    <span class="ss-stock-badge {% if v.inventory_quantity < 50 %}stock-low{% elsif v.inventory_quantity < 200 %}stock-mid{% else %}stock-high{% endif %}">
                      {% if v.inventory_quantity >= 1000 %}
                        {% assign k_val = v.inventory_quantity | divided_by: 100 | times: 1 %}
                        {% assign k_whole = k_val | divided_by: 10 %}
                        {% assign k_decimal = k_val | modulo: 10 %}
                        {% if k_decimal == 0 %}
                          {{ k_whole }}k
                        {% else %}
                          {{ k_whole }}.{{ k_decimal }}k
                        {% endif %}
                      {% else %}
                        {{ v.inventory_quantity }}
                      {% endif %}
                    </span>
                  {% else %}
                    <span class="ss-stock-badge stock-out">Out</span>
                  {% endif %}
                </div>
                <input type="number"
                       class="ss-input-field"
                       min="0"
                       max="{{ v.inventory_quantity }}"
                       placeholder="0"
                       {% if v.inventory_quantity <= 0 %}disabled{% endif %}
                       data-variant-id="{{ v.id }}"
                       data-price="{{ v.price | money_without_currency }}"
                       data-size-name="{{ v.option2 | escape }}"
                       oninput="window.updateMatrixTotal('{{ block.id }}')">
                <div class="ss-price-hint" id="price-hint-{{ v.id }}">{{ v.price | money }}</div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- 4. UPLOAD: Dynamic from DB via product metafield or API fallback -->
  {%- assign upload_locations = product.metafields.ss_custom.upload_locations.value -%}
  {%- if upload_locations != blank -%}
    <div class="ss-section ss-upload-wrapper" id="ss-upload-{{ block.id }}">
      <div class="ss-label">Upload Artwork</div>
      <div class="ss-upload-row" id="ss-upload-row-{{ block.id }}">
        {% for location in upload_locations %}
          <div class="ss-upload-card" onclick="document.getElementById('file-input-{{ location.name }}-{{ block.id }}').click()">
            <div class="ss-upload-content" id="placeholder-{{ location.name }}-{{ block.id }}">
               <span class="ss-upload-icon">+</span>
               <span class="ss-upload-text">{{ location.label }}</span>
            </div>

            <div class="ss-upload-preview" id="preview-{{ location.name }}-{{ block.id }}" style="display:none;">
              <div class="ss-preview-image"></div>
              <button class="ss-remove-btn" onclick="event.stopPropagation(); window.removeUpload('{{ location.name }}', '{{ block.id }}')">√ó</button>
            </div>

            <input type="file" id="file-input-{{ location.name }}-{{ block.id }}" hidden
                   onchange="window.handleFileUpload(this, '{{ location.name }}', '{{ block.id }}')">
          </div>
        {% endfor %}
      </div>
    </div>
  {%- else -%}
    <!-- Dynamic: JS will populate from DB API, default: Front + Back -->
    <div class="ss-section ss-upload-wrapper" id="ss-upload-{{ block.id }}">
      <div class="ss-label">Upload Artwork</div>
      <div class="ss-upload-row" id="ss-upload-row-{{ block.id }}">
        <div class="ss-upload-card" onclick="document.getElementById('file-input-full_front-{{ block.id }}').click()">
          <div class="ss-upload-content" id="placeholder-full_front-{{ block.id }}">
            <span class="ss-upload-icon">+</span>
            <span class="ss-upload-text">Front</span>
          </div>
          <div class="ss-upload-preview" id="preview-full_front-{{ block.id }}" style="display:none;">
            <div class="ss-preview-image"></div>
            <button class="ss-remove-btn" onclick="event.stopPropagation(); window.removeUpload('full_front', '{{ block.id }}')">√ó</button>
          </div>
          <input type="file" id="file-input-full_front-{{ block.id }}" hidden
                 onchange="window.handleFileUpload(this, 'full_front', '{{ block.id }}')">
        </div>
        <div class="ss-upload-card" onclick="document.getElementById('file-input-full_back-{{ block.id }}').click()">
          <div class="ss-upload-content" id="placeholder-full_back-{{ block.id }}">
            <span class="ss-upload-icon">+</span>
            <span class="ss-upload-text">Back</span>
          </div>
          <div class="ss-upload-preview" id="preview-full_back-{{ block.id }}" style="display:none;">
            <div class="ss-preview-image"></div>
            <button class="ss-remove-btn" onclick="event.stopPropagation(); window.removeUpload('full_back', '{{ block.id }}')">√ó</button>
          </div>
          <input type="file" id="file-input-full_back-{{ block.id }}" hidden
                 onchange="window.handleFileUpload(this, 'full_back', '{{ block.id }}')">
        </div>
      </div>
    </div>
  {%- endif -%}

  <!-- 4b. SHIPPING & DELIVERY INFO -->
  <div class="ss-section ss-shipping-section" id="ss-shipping-{{ block.id }}" style="display:none;"
       data-threshold="{{ block.settings.free_shipping_threshold | default: 500 }}">
    <div class="ss-shipping-bar-wrap">
      <div class="ss-shipping-label">
        <span id="ss-shipping-text-{{ block.id }}">üöö Free shipping on orders over ${{ block.settings.free_shipping_threshold | default: 500 }}</span>
      </div>
      <div class="ss-shipping-bar">
        <div class="ss-shipping-fill" id="ss-shipping-fill-{{ block.id }}" style="width:0%"></div>
      </div>
    </div>
    <div class="ss-delivery-estimate" id="ss-delivery-{{ block.id }}"></div>
  </div>

  <!-- 5. PRICE BREAKDOWN ALERT PANEL (Always Visible) -->
  <div class="ss-breakdown-panel" id="ss-breakdown-{{ block.id }}" style="display:none;">
    <div class="ss-breakdown-header">
      <span class="ss-breakdown-icon">üè∑Ô∏è</span>
      <span class="ss-breakdown-title" id="ss-breakdown-title-{{ block.id }}">Volume Discount Applied</span>
    </div>
    <div class="ss-breakdown-body" id="ss-breakdown-body-{{ block.id }}"></div>
    <div class="ss-breakdown-alert" id="ss-breakdown-alert-{{ block.id }}" style="display:none;"></div>
  </div>

  <!-- 5b. SMART UPSELL NUDGE -->
  <div class="ss-upsell-nudge" id="ss-upsell-{{ block.id }}" style="display:none;">
    <div class="ss-upsell-content" id="ss-upsell-content-{{ block.id }}"></div>
    <button class="ss-upsell-apply" id="ss-upsell-btn-{{ block.id }}" onclick="window.applyUpsell('{{ block.id }}')">Apply</button>
  </div>

  <!-- 6. FOOTER: Sticky-like Action Bar -->
  <div class="ss-footer">
    <div class="ss-total-wrapper">
      <span class="ss-total-label">Total</span>
      <span class="ss-total-price" id="ss-total-price-{{ block.id }}">$0.00</span>
    </div>
    <button id="ss-add-to-cart-{{ block.id }}" class="ss-action-btn" disabled onclick="window.addToCart('{{ block.id }}')">
      Add to Cart
    </button>
  </div>

  <!-- 7. LEAD CAPTURE FORM (Guest Users Only) -->
  {% unless customer %}
  <div class="ss-lead-capture" id="ss-lead-form-{{ block.id }}" style="display:none;">
    <div class="ss-lead-icon">üéØ</div>
    <div class="ss-lead-header">
      <div class="ss-lead-title">Want an even better deal on this order?</div>
      <div class="ss-lead-subtitle">
        Fill in your quantities above, drop your email below, and our team will reach out
        within <strong>60 minutes</strong> with a <strong>personalized bulk discount</strong> ‚Äî
        often <span class="ss-lead-highlight">15‚Äì30% below listed prices</span>.
      </div>
    </div>
    <div class="ss-lead-form-row">
      <input type="email" class="ss-lead-email" id="ss-lead-email-{{ block.id }}"
             placeholder="your@email.com" required>
      <button class="ss-lead-submit" id="ss-lead-submit-{{ block.id }}"
              onclick="window.submitLeadForm('{{ block.id }}')">
        Get My Custom Quote
      </button>
    </div>
    <div class="ss-lead-trust">
      üîí No spam, ever. Your info stays between us.
      <span class="ss-lead-counter">üî• <strong id="ss-lead-count-{{ block.id }}">23</strong> people requested quotes today</span>
    </div>
    <div class="ss-lead-success" id="ss-lead-success-{{ block.id }}" style="display:none;">
      <div class="ss-lead-success-icon">üéâ</div>
      <div class="ss-lead-success-text">
        <strong>Quote request sent!</strong> Our team will email you within 60 minutes with your personalized discount.
      </div>
    </div>
  </div>
  {% endunless %}

</div>

<style>
/* ‚îÄ‚îÄ‚îÄ 2026 MODERN RESET ‚îÄ‚îÄ‚îÄ */
.ss-clean-widget {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  color: #111;
  max-width: 100%;
  margin: 40px 0;
}

.ss-clean-widget * {
  box-sizing: border-box;
}

/* HEADER */
/* ‚îÄ‚îÄ‚îÄ VIP MEMBER ALERT ‚îÄ‚îÄ‚îÄ */
.ss-vip-alert {
  display: flex;
  align-items: flex-start;
  gap: 14px;
  background: linear-gradient(135deg, #450a0a, #7f1d1d, #991b1b);
  border: 1px solid rgba(239, 68, 68, 0.3);
  border-radius: 16px;
  padding: 16px 20px;
  margin-bottom: 20px;
  position: relative;
  overflow: hidden;
  animation: ss-vip-in 0.6s ease-out;
}
.ss-vip-alert::before {
  content: '';
  position: absolute;
  top: 0; left: -100%;
  width: 200%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
  animation: ss-vip-shimmer 3s ease-in-out infinite;
}
@keyframes ss-vip-shimmer {
  0% { transform: translateX(-50%); }
  100% { transform: translateX(50%); }
}
@keyframes ss-vip-in {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}
.ss-vip-badge {
  flex-shrink: 0;
  background: linear-gradient(135deg, #fbbf24, #f59e0b);
  color: #450a0a;
  font-weight: 800;
  font-size: 11px;
  letter-spacing: 0.05em;
  padding: 5px 10px;
  border-radius: 8px;
  white-space: nowrap;
}
.ss-vip-body {
  flex: 1;
  position: relative;
  z-index: 1;
}
.ss-vip-title {
  font-size: 13px;
  font-weight: 600;
  color: #fecaca;
  margin-bottom: 4px;
}
.ss-vip-detail {
  font-size: 12px;
  color: #fca5a5;
  line-height: 1.6;
}
.ss-vip-detail strong {
  color: #fff;
  font-weight: 700;
}
.ss-vip-status {
  margin-top: 8px;
  font-size: 11px;
  font-weight: 600;
}
.ss-vip-status.active {
  color: #86efac;
}
.ss-vip-status.pending {
  color: #fde68a;
}
/* Guest hint (not logged in) */
.ss-vip-guest-hint {
  background: rgba(254, 242, 242, 0.6);
  border: 1px solid rgba(252, 165, 165, 0.3);
  border-radius: 12px;
  padding: 12px 16px;
  font-size: 12px;
  color: #991b1b;
  margin-bottom: 16px;
  text-align: center;
}
.ss-vip-login-link {
  color: #dc2626;
  font-weight: 700;
  text-decoration: underline;
  text-underline-offset: 2px;
}
.ss-vip-login-link:hover {
  color: #b91c1c;
}

/* ‚îÄ‚îÄ‚îÄ LEAD CAPTURE FORM ‚îÄ‚îÄ‚îÄ */
.ss-lead-capture {
  background: linear-gradient(135deg, #fef3c7, #fde68a, #fbbf24);
  border: 2px solid rgba(245, 158, 11, 0.3);
  border-radius: 18px;
  padding: 24px;
  margin-top: 20px;
  position: relative;
  overflow: hidden;
  animation: ss-lead-in 0.5s ease-out;
}
.ss-lead-capture::before {
  content: '';
  position: absolute;
  top: -50%; right: -50%;
  width: 100%; height: 100%;
  background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
  pointer-events: none;
}
@keyframes ss-lead-in {
  from { opacity: 0; transform: translateY(15px); }
  to { opacity: 1; transform: translateY(0); }
}
.ss-lead-icon {
  font-size: 28px;
  margin-bottom: 10px;
}
.ss-lead-header {
  position: relative;
  z-index: 1;
  margin-bottom: 16px;
}
.ss-lead-title {
  font-size: 16px;
  font-weight: 800;
  color: #78350f;
  margin-bottom: 6px;
  letter-spacing: -0.02em;
}
.ss-lead-subtitle {
  font-size: 13px;
  color: #92400e;
  line-height: 1.7;
}
.ss-lead-subtitle strong {
  color: #78350f;
}
.ss-lead-highlight {
  background: rgba(220, 38, 38, 0.12);
  color: #dc2626;
  padding: 2px 6px;
  border-radius: 4px;
  font-weight: 700;
}
.ss-lead-form-row {
  display: flex;
  gap: 10px;
  position: relative;
  z-index: 1;
  margin-bottom: 12px;
}
.ss-lead-email {
  flex: 1;
  padding: 12px 16px;
  border: 2px solid rgba(120, 53, 15, 0.2);
  border-radius: 12px;
  font-size: 14px;
  background: rgba(255,255,255,0.9);
  color: #1e293b;
  outline: none;
  transition: border-color 0.3s;
}
.ss-lead-email:focus {
  border-color: #d97706;
  box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.15);
}
.ss-lead-email::placeholder {
  color: #94a3b8;
}
.ss-lead-submit {
  padding: 12px 20px;
  background: linear-gradient(135deg, #dc2626, #b91c1c);
  color: #fff;
  border: none;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.3s;
  animation: ss-lead-pulse 2s ease-in-out infinite;
}
.ss-lead-submit:hover {
  background: linear-gradient(135deg, #b91c1c, #991b1b);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(185, 28, 28, 0.3);
}
.ss-lead-submit:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  animation: none;
}
@keyframes ss-lead-pulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.3); }
  50% { box-shadow: 0 0 0 8px rgba(220, 38, 38, 0); }
}
.ss-lead-trust {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 11px;
  color: #92400e;
  position: relative;
  z-index: 1;
}
.ss-lead-counter {
  font-size: 11px;
  color: #b91c1c;
}
/* Success state */
.ss-lead-success {
  display: flex;
  align-items: center;
  gap: 12px;
  background: rgba(255,255,255,0.7);
  border: 2px solid #16a34a;
  border-radius: 12px;
  padding: 16px;
  margin-top: 14px;
  animation: ss-lead-in 0.4s ease-out;
}
.ss-lead-success-icon {
  font-size: 32px;
  flex-shrink: 0;
}
.ss-lead-success-text {
  font-size: 13px;
  color: #166534;
  line-height: 1.5;
}
.ss-lead-success-text strong {
  color: #15803d;
}

/* Mobile */
@media (max-width: 480px) {
  .ss-lead-form-row {
    flex-direction: column;
  }
  .ss-lead-trust {
    flex-direction: column;
    gap: 4px;
    text-align: center;
  }
}

.ss-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}
.ss-title {
  font-size: 24px;
  font-weight: 700;
  letter-spacing: -0.5px;
  margin: 0;
}

/* LABELS */
.ss-label {
  font-size: 13px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: #666;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}
#ss-selected-color-name {
  color: #111;
  font-weight: 700;
}

/* COLORS: Horizontal Scroll or Wrap, Cleaning Floating Look */
.ss-color-list {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-bottom: 40px;
}
.ss-color-item {
  position: relative;
  cursor: pointer;
  group: hover;
}
.ss-color-circle {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  overflow: hidden;
  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s;
  border: 2px solid transparent;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  background: #f1f5f9;
}
.ss-color-circle img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.ss-no-img {
  display: block; width: 100%; height: 100%; background: #eee;
}

/* Selected State */
.ss-color-selected .ss-color-circle {
  transform: scale(1.1);
  box-shadow: 0 0 0 2px #fff, 0 0 0 4px #111;
}
.ss-tooltip {
  position: absolute;
  bottom: -30px;
  left: 50%;
  transform: translateX(-50%) translateY(5px);
  background: #111;
  color: #fff;
  font-size: 11px;
  padding: 4px 8px;
  border-radius: 4px;
  opacity: 0;
  pointer-events: none;
  transition: all 0.2s;
  white-space: nowrap;
  z-index: 10;
}
.ss-color-item:hover .ss-tooltip {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* VOLUME PRICING TABLE */
.ss-volume-wrapper {
  margin-bottom: 30px;
}
.ss-volume-scroll {
  overflow-x: auto;
  padding-bottom: 10px;
}
.ss-volume-row {
  display: flex;
  gap: 0;
  background: #f9fafb;
  border-radius: 12px;
  overflow: hidden;
  width: max-content;
  min-width: 100%;
}
.ss-volume-cell {
  flex: 1;
  min-width: 80px;
  padding: 12px 16px;
  text-align: center;
  border-right: 1px solid #e5e7eb;
  display: flex;
  flex-direction: column;
  gap: 4px;
  transition: background 0.2s;
}
.ss-volume-cell:last-child { border-right: none; }
.ss-volume-cell.active {
  background: #dbeafe; /* Light blue highlight */
  border-bottom: 3px solid #3b82f6;
}
.ss-vol-qty {
  font-size: 13px;
  font-weight: 700;
  color: #111;
}
.ss-vol-price {
  font-size: 14px;
  color: #666;
}
.ss-volume-cell.active .ss-vol-price {
  color: #1d4ed8;
  font-weight: 700;
}

/* GRID LAYOUT */
.ss-grid-layout {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(105px, 1fr));
  gap: 12px;
  margin-bottom: 40px;
}

/* SIZE INPUT ITEM */
.ss-size-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  padding: 10px 6px 8px;
  border-radius: 14px;
  background: #fafafa;
  border: 1.5px solid #eee;
  transition: all 0.2s ease;
}
.ss-size-item:hover {
  border-color: #d1d5db;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}
.ss-size-item:has(.ss-input-field:focus) {
  border-color: #111;
  background: #fff;
  box-shadow: 0 4px 16px rgba(0,0,0,0.08);
}

.ss-size-header {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}
.ss-size-name {
  font-size: 15px;
  font-weight: 800;
  color: #111;
  letter-spacing: 0.02em;
}

/* Stock Badge ‚Äî pill style */
.ss-stock-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-weight: 700;
  padding: 2px 8px;
  border-radius: 20px;
  letter-spacing: 0.03em;
  white-space: nowrap;
  line-height: 1.4;
}
.ss-stock-badge.stock-high {
  background: #dcfce7;
  color: #15803d;
}
.ss-stock-badge.stock-mid {
  background: #fef3c7;
  color: #b45309;
}
.ss-stock-badge.stock-low {
  background: #fee2e2;
  color: #dc2626;
  animation: ss-stock-pulse 2s ease-in-out infinite;
}
.ss-stock-badge.stock-out {
  background: #f3f4f6;
  color: #9ca3af;
  font-style: italic;
  font-weight: 500;
}
@keyframes ss-stock-pulse {
  0%,100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.7; transform: scale(0.97); }
}

/* Input Style */
.ss-input-field {
  width: 100%;
  height: 46px;
  background: #fff;
  border: 2px solid #e5e7eb;
  border-radius: 10px;
  text-align: center;
  font-size: 18px;
  font-weight: 700;
  color: #111;
  transition: all 0.2s;
  outline: none;
}
.ss-input-field:focus {
  background: #fff;
  border-color: #111;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
}
.ss-input-field:disabled {
  opacity: 0.4;
  cursor: not-allowed;
  background: #f9fafb;
  border-color: #f3f4f6;
}
.ss-price-hint {
  font-size: 11px;
  color: #888;
  text-align: center;
  margin-top: 2px;
  font-weight: 600;
  cursor: help;
  position: relative;
}
.ss-price-tooltip {
  visibility: hidden;
  opacity: 0;
  width: 140px;
  background-color: #333;
  color: #fff;
  text-align: left;
  border-radius: 6px;
  padding: 8px;
  position: absolute;
  z-index: 99999 !important;
  bottom: 125%; /* Show above the price */
  left: 50%;
  margin-left: -70px;
  font-size: 10px;
  line-height: 1.4;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  transition: opacity 0.3s;
  pointer-events: none;
  white-space: nowrap;
}
.ss-price-tooltip::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: #333 transparent transparent transparent;
}
.ss-price-hint:hover .ss-price-tooltip {
  visibility: visible;
  opacity: 1;
}
.ss-tooltip-row {
  display: flex;
  justify-content: space-between;
}
.ss-tooltip-row.total {
  border-top: 1px solid #555;
  margin-top: 4px;
  padding-top: 2px;
  font-weight: bold;
}

/* UPLOAD: Minimalist Tiles */
.ss-upload-row {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 12px;
  margin-bottom: 40px;
}
.ss-upload-card {
  aspect-ratio: 4/3;
  background: #f9fafb;
  border: 1px dashed #d1d5db;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}
.ss-upload-card:hover {
  background: #eff6ff;
  border-color: #3b82f6;
  border-style: solid;
}
.ss-upload-content {
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}
.ss-upload-icon {
  font-size: 24px;
  color: #9ca3af;
}
.ss-upload-text {
  font-size: 12px;
  font-weight: 600;
  color: #4b5563;
}
.ss-preview-image {
  position: absolute;
  top: 0; left: 0; width: 100%; height: 100%;
  background-size: cover;
  background-position: center;
}
.ss-remove-btn {
  position: absolute;
  top: 6px; right: 6px;
  width: 24px; height: 24px;
  background: #fff;
  border-radius: 50%;
  border: 1px solid #e5e7eb;
  cursor: pointer;
  font-size: 16px;
  line-height: 1;
  color: #ef4444;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* FOOTER BAR */
.ss-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 20px;
  padding-top: 20px;
  border-top: 1px solid #f3f4f6;
}
.ss-total-wrapper {
  display: flex;
  flex-direction: column;
}
.ss-total-label {
  font-size: 12px;
  color: #666;
  text-transform: uppercase;
}
.ss-total-price {
  font-size: 24px;
  font-weight: 800;
  color: #111;
}

.ss-action-btn {
  flex: 1;
  max-width: 400px;
  height: 56px;
  background: #111;
  color: #fff;
  border: none;
  border-radius: 28px; /* Pill shape */
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.1s, opacity 0.2s;
}
.ss-action-btn:hover:not(:disabled) {
  opacity: 0.9;
  transform: translateY(-1px);
}
.ss-action-btn:disabled {
  background: #e5e7eb;
  color: #9ca3af;
  cursor: not-allowed;
}

/* ‚îÄ‚îÄ‚îÄ SHIPPING & DELIVERY ‚îÄ‚îÄ‚îÄ */
.ss-shipping-section {
  margin: 16px 0;
}
.ss-shipping-bar-wrap {
  background: rgba(248, 250, 252, 0.85);
  backdrop-filter: blur(8px);
  border: 1px solid rgba(226, 232, 240, 0.5);
  border-radius: 14px;
  padding: 14px 18px;
}
.ss-shipping-label {
  font-size: 12px;
  color: #64748b;
  margin-bottom: 8px;
  font-weight: 500;
}
.ss-shipping-label .ss-ship-done {
  color: #16a34a;
  font-weight: 600;
}
.ss-shipping-bar {
  width: 100%;
  height: 6px;
  background: #e2e8f0;
  border-radius: 3px;
  overflow: hidden;
}
.ss-shipping-fill {
  height: 100%;
  background: linear-gradient(90deg, #94a3b8, #1e293b);
  border-radius: 3px;
  transition: width 0.5s ease;
}
.ss-shipping-fill.done {
  background: linear-gradient(90deg, #22c55e, #16a34a);
}
.ss-delivery-estimate {
  margin-top: 10px;
  font-size: 11.5px;
  color: #64748b;
  display: flex;
  align-items: center;
  gap: 6px;
}
.ss-delivery-estimate strong {
  color: #1e293b;
}
.ss-delivery-countdown {
  color: #dc2626;
  font-weight: 600;
}

/* ‚îÄ‚îÄ‚îÄ BREAKDOWN PANEL (Soft Frosted) ‚îÄ‚îÄ‚îÄ */
.ss-breakdown-panel {
  background: rgba(248, 250, 252, 0.85);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid rgba(226, 232, 240, 0.6);
  border-radius: 16px;
  padding: 20px;
  margin: 16px 0;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
}
.ss-breakdown-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
  font-weight: 600;
  font-size: 13px;
  color: #64748b;
  letter-spacing: 0.02em;
}
.ss-breakdown-icon {
  font-size: 15px;
  opacity: 0.8;
}
.ss-breakdown-body {
  font-size: 12px;
  color: #475569;
  line-height: 1.9;
}
.ss-breakdown-row {
  display: flex;
  justify-content: space-between;
  padding: 3px 0;
  border-bottom: 1px solid rgba(226, 232, 240, 0.4);
}
.ss-breakdown-row:last-child {
  border-bottom: none;
}
.ss-breakdown-row.total-row {
  border-top: 1px solid #e2e8f0;
  border-bottom: none;
  margin-top: 8px;
  padding-top: 10px;
  font-weight: 700;
  font-size: 13px;
  color: #1e293b;
}
.ss-breakdown-alert {
  margin-top: 12px;
  padding: 10px 14px;
  background: rgba(254, 249, 195, 0.5);
  border: 1px solid rgba(253, 230, 138, 0.5);
  border-radius: 10px;
  font-size: 11px;
  color: #92400e;
  display: flex;
  align-items: center;
  gap: 8px;
}
.ss-savings-badge {
  display: inline-block;
  background: rgba(220, 252, 231, 0.7);
  color: #166534;
  padding: 2px 10px;
  border-radius: 20px;
  font-size: 10px;
  font-weight: 600;
  margin-left: 8px;
  letter-spacing: 0.01em;
}

/* ‚îÄ‚îÄ‚îÄ UPSELL NUDGE (Warm & Soft) ‚îÄ‚îÄ‚îÄ */
.ss-upsell-nudge {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 14px;
  background: rgba(255, 251, 235, 0.7);
  border: 1px solid rgba(253, 230, 138, 0.4);
  border-radius: 14px;
  padding: 14px 20px;
  margin: 10px 0 16px 0;
  animation: ss-nudge-in 0.5s ease-out;
  box-shadow: 0 1px 3px rgba(0,0,0,0.03);
}
@keyframes ss-nudge-in {
  from { opacity: 0; transform: translateY(-6px); }
  to { opacity: 1; transform: translateY(0); }
}
.ss-upsell-content {
  flex: 1;
  font-size: 12.5px;
  color: #78716c;
  line-height: 1.6;
}
.ss-upsell-content strong {
  color: #44403c;
  font-weight: 700;
}
.ss-upsell-apply {
  flex-shrink: 0;
  background: #1e293b;
  color: #fff;
  font-weight: 600;
  font-size: 12px;
  letter-spacing: 0.03em;
  border: none;
  border-radius: 10px;
  padding: 10px 22px;
  cursor: pointer;
  transition: all 0.25s ease;
  box-shadow: 0 2px 8px rgba(30,41,59,0.15);
}
.ss-upsell-apply:hover {
  background: #334155;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(30,41,59,0.2);
}
.ss-upsell-apply:active {
  transform: translateY(0);
  box-shadow: 0 1px 4px rgba(30,41,59,0.15);
}

/* Spinner Animation */
.ss-spinner {
  display: inline-block;
  width: 16px; height: 16px;
  border: 2px solid #e2e8f0;
  border-top-color: #1e293b;
  border-radius: 50%;
  animation: sspin 0.6s linear infinite;
}
@keyframes sspin { to { transform: rotate(360deg); } }

/* Mobile Optimizations */
@media (max-width: 600px) {
  .ss-grid-layout {
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
  }
  .ss-input-field {
    height: 44px;
    font-size: 16px;
  }
  .ss-header { flex-direction: column; align-items: flex-start; gap: 10px; }
  .ss-footer { flex-direction: column; align-items: stretch; gap: 16px; }
  .ss-action-btn { width: 100%; max-width: none; }
  .ss-upsell-nudge {
    flex-direction: column;
    text-align: center;
    gap: 10px;
  }
  .ss-breakdown-panel { padding: 14px; }
}
</style>

<script src="{{ 'matrix.js' | asset_url }}?v={{ "now" | date: "%N" }}" defer></script>

{% schema %}
{
  "name": "SS Matrix Order V4",
  "target": "section",
  "settings": [
    { "type": "text", "id": "widget_title", "label": "Widget Title", "default": "Quick Order" },
    { "type": "text", "id": "button_text", "label": "Button Text", "default": "Add to Cart" },
    { "type": "checkbox", "id": "show_warehouse", "label": "Show Warehouse Stock", "default": false },
    { "type": "header", "content": "üî¥ VIP Member Discounts" },
    { "type": "checkbox", "id": "vip_enabled", "label": "Enable VIP Member Pricing", "default": true },
    { "type": "range", "id": "vip_discount", "label": "VIP Extra Discount (%)", "min": 5, "max": 50, "step": 5, "default": 10 },
    { "type": "range", "id": "vip_min_order", "label": "VIP Minimum Order ($)", "min": 50, "max": 2000, "step": 50, "default": 200 },
    { "type": "header", "content": "Shipping & Delivery" },
    { "type": "range", "id": "free_shipping_threshold", "label": "Free Shipping Threshold ($)", "min": 0, "max": 2000, "step": 50, "default": 500 },
    { "type": "range", "id": "processing_days", "label": "Processing Days", "min": 1, "max": 5, "step": 1, "default": 2 },
    { "type": "range", "id": "shipping_days_min", "label": "Shipping Days (Min)", "min": 1, "max": 10, "step": 1, "default": 3 },
    { "type": "range", "id": "shipping_days_max", "label": "Shipping Days (Max)", "min": 2, "max": 14, "step": 1, "default": 7 },
    { "type": "header", "content": "Colors & Styles" },
    { "type": "color", "id": "primary_color", "label": "Accent Color", "default": "#111111" }
  ]
}
{% endschema %}
